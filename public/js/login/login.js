///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////// VARIABLES ///////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////// FUNCIONES  //////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////// OPCIONES  ///////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////// APIS - llamdas al servidor ///////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

const iniciarSesion = (datas) => {
  return new Promise((resolve, reject) => {
    fetch("login/iniciarSesion", {
      method: "POST",
      body: datas,
    })
      .then((respuesta) => respuesta.json())
      .then((datos) => {
        resolve(datos);
      })
      .catch((msg) => {
        reject(msg);
      });
  });
};

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////// EVENTOS //////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

document.getElementById("login").addEventListener("submit", (e) => {
  e.preventDefault();
  btn_cargando("registrar");
  const data = new FormData();
  data.append("user", document.getElementById("user").value);
  data.append("pass", document.getElementById("pass").value);
  iniciarSesion(data)
    .then((dato) => {
      btn_cargando_fin("registrar", "Ingresar");
      if(dato.status){
        window.location.href = APP_URL
      }else{
        Swal.fire(
          'Error',
          dato.mensaje,
          'error'
        )
      }
    })
    .catch((error) => {
      btn_cargando_fin("registrar", "Ingresar");
      console.log(error);
    });
});

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////// INICIALIZACIONES ///////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

document.addEventListener("DOMContentLoaded", function () {
  // ══════════════════════════════════════════
  // VALOR QUE SE EJECUTA AL INICIAR - DEFECTO
  // ════╦═════════════════════════════════════
  //     ║
  //     ╚═  Tabla Citas
  /*        */
  // // validacionFechasInicial()
  //   const data = new FormData();
    // Promise.allSettled([
    //   listarAntesdeExantema(data),
    // ])
    //   .then((datos) => {
    //     if (datos[0].status == "fulfilled") {
    //     //   code
    //     } else {
    //     //  code
    //     }
    //   })
    //   .catch((error) => {
    //     $("#_registro_error").modal("show");
    //   });
});

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////// UTILITIES //////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
function btn_cargando(uid) {
  document.querySelector(`.${uid}`).innerHTML = `
      <div class="text-center">
      <div class="spinner-border spinner-border-sm" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
    </div>        
      `;
  document.querySelector(`.${uid}`).setAttribute("disabled", "disabled");
}
function btn_cargando_fin(uid, texto) {
  document.querySelector(`.${uid}`).innerHTML = `
              ${texto}
              `;
  document.querySelector(`.${uid}`).removeAttribute("disabled");
}
